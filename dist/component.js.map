{"version":3,"file":"component.js","names":["_diffs","require","_render","_typeof","o","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","protoProps","staticProps","t","_toPrimitive","String","r","e","toPrimitive","call","Number","Component","exports","value","setState","updater","mountedElement","undefined","Error","state","applyUpdate","getUpdateDiff","setProps","componentWillRecieveProps","initProps","currentRootNode","render","_this","newRootNode","diff","createDiff","kind","callback","elem","setTimeout","componentDidUpdate","notifyMounted","_this2","componentDidMount","unmount","componentWillUnmount"],"sources":["../src/lib/component.ts"],"sourcesContent":["import { createDiff, VDomNodeUpdater } from \"./diffs\"\nimport { applyUpdate } from \"./render\"\nimport { VDomNode } from \"./vdom\"\n\nexport abstract class Component<P, S> {\n\n    protected props: P\n    protected state: S\n\n    private currentRootNode: VDomNode\n    private mountedElement: HTMLElement | Text\n\n    protected setState(updater: (s:S) => S) {\n        if(this.mountedElement == undefined) throw new Error(\"you are updating an unmounted component\")\n        this.state = updater(this.state)\n        applyUpdate(this.mountedElement, this.getUpdateDiff())\n    }\n\n    public setProps(props: P): VDomNodeUpdater {\n        if(this.mountedElement == null)\n            throw new Error(\"You are setting the props of an inmounted component\")\n\n        this.state = this.componentWillRecieveProps(props, this.state)\n        this.props = props\n        return this.getUpdateDiff()\n    }\n\n    public initProps(props: P): VDomNode {\n        this.props = props\n        this.currentRootNode = this.render()\n        return this.currentRootNode\n    }\n\n    private getUpdateDiff() : VDomNodeUpdater {\n        const newRootNode = this.render()\n        const diff = createDiff(this.currentRootNode, newRootNode)\n        if(diff.kind == 'replace') diff.callback = elem => this.mountedElement = elem\n        this.currentRootNode = newRootNode\n        setTimeout(() => this.componentDidUpdate())\n        return diff\n    }\n\n    public notifyMounted(elem: HTMLElement | Text) {\n        this.mountedElement = elem\n        setTimeout(() => this.componentDidMount())\n    }\n\n    public unmount() {\n        this.componentWillUnmount()\n        this.mountedElement = null\n    }\n\n    public componentDidMount() {}\n    public componentWillRecieveProps(props: P, state: S): S { return state }\n    public componentDidUpdate() { }\n    public componentWillUnmount() { }\n\n    public abstract render(): VDomNode\n}"],"mappings":"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","ignoreList":[]}