{"version":3,"file":"render.js","names":["renderElement","rootNode","kind","document","createTextNode","value","instance","elem","render","notifyMounted","component","initProps","props","createElement","tagname","att","childeren","forEach","child","appendChild","applyUpdate","exports","diff","newElem","newNode","replaceWith","callback","Error","attributes","remove","removeAttribute","set","applyChildrenDiff","operations","offset","i","length","childUpdater","childNodes","after","node","childElem","renderDOM","htmlId","getElementById","parent","parentElement","children"],"sources":["../src/lib/render.ts"],"sourcesContent":["import { VDomNode } from \"./vdom\";\nimport { ChildUpdater, VDomNodeUpdater } from \"./diffs\";\n\nconst renderElement = (rootNode: VDomNode): HTMLElement | Text => {\n    if (rootNode.kind == 'text') {\n        return document.createTextNode(rootNode.value)\n    }\n\n    if(rootNode.kind == 'component') {\n        if(rootNode.instance) {\n            const elem = renderElement(rootNode.instance.render())\n            rootNode.instance.notifyMounted(elem as HTMLElement)\n            return elem\n        }\n\n        rootNode.instance = new rootNode.component()\n        const elem = renderElement( rootNode.instance.initProps(rootNode.props))\n        rootNode.instance.notifyMounted(elem as HTMLElement)\n        return elem\n    }\n\n    const elem = document.createElement(rootNode.tagname)\n\n    for (const att in (rootNode.props || {})) {\n        (elem as any)[att] = rootNode.props[att]\n    }\n\n    (rootNode.childeren || []).forEach(child =>\n        elem.appendChild(renderElement(child))\n    )\n\n    return elem\n}\n\nexport const applyUpdate = (elem: HTMLElement | Text, diff: VDomNodeUpdater): HTMLElement | Text => {\n    if (diff.kind == 'skip') return elem\n\n    if (diff.kind == 'replace') {\n        const newElem = renderElement(diff.newNode)\n        elem.replaceWith(newElem)\n        if(diff.callback) diff.callback(newElem)\n        return newElem\n    }\n\n    if('wholeText' in elem) throw new Error('invalid update for Text node')\n\n    for (const att in diff.attributes.remove) {\n        elem.removeAttribute(att)\n    }\n\n    for (const att in diff.attributes.set) {\n        (elem as any)[att] = diff.attributes.set[att]\n    }\n\n    applyChildrenDiff(elem, diff.childeren)\n\n    return elem\n}\n\nconst applyChildrenDiff = (elem: HTMLElement, operations: ChildUpdater[]) => {\n    let offset = 0\n    for (let i = 0; i < operations.length; i++) {\n        const childUpdater = operations[i]\n\n        if (childUpdater.kind == 'skip') continue\n\n        if (childUpdater.kind == 'insert') {\n            if (elem.childNodes[i + offset - 1]) elem.childNodes[i + offset - 1].after(renderElement(childUpdater.node))\n            else elem.appendChild(renderElement(childUpdater.node))\n            continue\n        }\n\n        const childElem = elem.childNodes[i + offset]\n\n        if (childUpdater.kind == 'remove') {\n            childElem.remove()\n            offset -= 1\n            continue\n        }\n\n        applyUpdate(childElem as HTMLElement, childUpdater)\n    }\n}\n\nexport const renderDOM = (htmlId: string, rootNode: VDomNode): HTMLElement => {\n    const elem = document.getElementById(htmlId)\n    if (elem == null) {\n        throw new Error('Container elem not found')\n    }\n\n    const parent = elem.parentElement\n\n    elem.replaceWith(renderElement(rootNode))\n\n    return parent.children[0] as HTMLElement\n}"],"mappings":"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","ignoreList":[]}